/*! skrollr v0.3.0 https://github.com/Prinzhorn/skrollr | free to use under terms of MIT license */
(function(a,b,c){function q(a){var e=this;a=a||{};if(a.easing)for(var f in a.easing)o[f]=a.easing[f];e.scale=a.scale||1,e.listeners={beforerender:a.beforerender||d,render:a.render||d},e.skrollables=[],e.maxKeyFrame=a.maxKeyFrame||0,e.dir="down",e.lastTop=-1,e.curTop=0;var g=b.getElementsByTagName("*"),i=[];for(var j=0;j<g.length;j++){var k=g[j],l=[];if(!k.attributes)continue;for(var m=0;m<k.attributes.length;m++){var n=k.attributes[m],p=n.name.match(h);if(p!==null){var q,s;q=(p[2]|0)*e.scale,s={frame:q,props:n.value},l.push(s),p[1]==="-end"&&i.push(s),q>this.maxKeyFrame&&(e.maxKeyFrame=q)}}l.length&&(e.skrollables.push({element:k,keyFrames:l}),r(k,"skrollable"))}for(var j=0;j<i.length;j++){var s=i[j];s.frame=e.maxKeyFrame-s.frame}for(var j=0;j<e.skrollables.length;j++){var t=e.skrollables[j];t.keyFrames.sort(function(a,b){return a.frame-b.frame}),e._parseProps(t),e._fillProps(t)}var u=b.createElement("div"),v=u.style;return v.width="1px",v.height=e.maxKeyFrame+b.documentElement.clientHeight+"px",v.position="absolute",v.right=v.top=v.zIndex="0",b.getElementsByTagName("body")[0].appendChild(u),e._render(),u=v=i=a=c,e}var d=function(){},e=Object.prototype.hasOwnProperty,f=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,1e3/30)},g=/^\s*(.*)\s$/,h=/^data(-end)?-?(\d+)?$/,i=/:|;/g,j=/^([a-z-]+)\[(\w+)\]$/,k=/-([a-z])/g,l=/(:?\+|-)?[\d.]+/g,m=/rgba?\(\s*-?\d+\s*,\s*-?\d+\s*,\s*-?\d+/g,n=["O","Moz","webkit","ms"],o={begin:function(){return 0},end:function(){return 1},linear:function(a){return a},quadratic:function(a){return a*a},cubic:function(a){return a*a*a*a},swing:function(a){return-Math.cos(a*Math.PI)/2+.5},bounce:function(a){var b;switch(!0){case a<=.5083:b=3;break;case a<=.8489:b=9;break;case a<=.96208:b=27;break;case a<=.99981:b=91;break;default:return 1}return 1-Math.abs(3*Math.cos(a*b*1.028)/b)}},p={};q.prototype.setScrollTop=function(a){pageYOffset=b.body.scrollTop=b.documentElement.scrollTop=a},q.prototype.on=function(a,b){this.listeners[a]=b||d},q.prototype.off=function(a){this.listeners[a]=d},q.prototype._calcSteps=function(a,b){var c=this,d=a.keyFrames;if(b<d[0].frame)r(a.element,"hidden");else if(b>d[d.length-1].frame){s(a.element,"hidden");var f=d[d.length-1],g;for(var h in f.props)e.call(f.props,h)&&(g=c._interpolateString(f.props[h].value),c._setStyle(a.element,h,g))}else{s(a.element,"hidden");for(var i=0;i<d.length-1;i++)if(b>=d[i].frame&&b<=d[i+1].frame){var j=d[i],k=d[i+1];for(var h in j.props)if(e.call(j.props,h)){var l=(b-j.frame)/(k.frame-j.frame);l=j.props[h].easing(l);var g=c._calcInterpolation(j.props[h].value,k.props[h].value,l);g=c._interpolateString(g),c._setStyle(a.element,h,g)}break}}},q.prototype._render=function(){var c=this;c.curTop=a.pageYOffset||b.documentElement.scrollTop||b.body.scrollTop||0;if(c.lastTop!==c.curTop){c.dir=c.curTop>=c.lastTop?"down":"up";var d={curTop:c.curTop,lastTop:c.lastTop,maxTop:c.maxKeyFrame,direction:c.dir},e=c.listeners.beforerender.call(c,d);if(e!==!1){for(var g=0;g<c.skrollables.length;g++)c._calcSteps(c.skrollables[g],c.curTop);c.lastTop=c.curTop,c.listeners.render.call(c,d)}}f(function(){c._render()})},q.prototype._parseProps=function(a){var b=this;for(var c=0;c<a.keyFrames.length;c++){var d=a.keyFrames[c],e=d.props.split(i),f,g,h;d.props={};for(var k=0;k<e.length-1;k+=2)f=e[k],g=e[k+1],h=f.match(j),h!==null?(f=h[1],h=h[2]):h="linear",g=b._parseProp(g),d.props[f]={value:g,easing:o[h]}}},q.prototype._parseProp=function(a){var b=[];return a=a.replace(m,function(a){return a.replace(l,function(a){return parseInt(a,10)/255*100+"%"})}),a=a.replace(l,function(a){return b.push(parseFloat(a,10)),"?"}),b.unshift(a),b},q.prototype._fillProps=function(a){var b={};for(var c=0;c<a.keyFrames.length;c++)this._fillPropForFrame(a.keyFrames[c],b);b={};for(var c=a.keyFrames.length-1;c>=0;c--)this._fillPropForFrame(a.keyFrames[c],b)},q.prototype._fillPropForFrame=function(a,b){for(var c in b)e.call(a.props,c)||(a.props[c]=b[c]);for(var c in a.props)b[c]=a.props[c]},q.prototype._calcInterpolation=function(a,b,c){if(a.length!==b.length)throw"Can't interpolate between \""+a[0]+'" and "'+b[0]+'"';var d=[a[0]];for(var e=1;e<a.length;e++)d[e]=a[e]+(b[e]-a[e])*c;return d},q.prototype._interpolateString=function(a){var b=1;return a[0].replace(/\?/g,function(){return a[b++]})},q.prototype._setStyle=function(a,b,c){var d=a.style;b=b.replace(k,function(a,b){return b.toUpperCase()}).replace("-","");if(b==="zIndex"){d[b]=""+(c|0);return}try{d[b]=c}catch(e){}var f=b.slice(0,1).toUpperCase()+b.slice(1);try{for(var g=0;g<n.length;g++)d[n[g]+f]=c}catch(e){}if(p.setStyle)for(var g=0;g<p.setStyle.length;g++)p.setStyle[0].call(this,a,b,c)};var r=function(a,b){t(a.className).indexOf(t(b))===-1&&(a.className=(a.className+" "+b).replace(g,"$1"))},s=function(a,b){a.className=t(a.className).replace(t(b),"").replace(g,"$1")},t=function(a){return" "+a+" "};a.skrollr={init:function(a){return new q(a)},plugin:function(a,b){p[a]?p[a].push(b):p[a]=[b]},VERSION:"0.3.0"}})(window,document);
